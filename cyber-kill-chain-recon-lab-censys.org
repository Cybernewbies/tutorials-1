#+TITLE: Cyber Kill Chain
#+DATE: Part 1: Reconnaissance
#+AUTHOR: Zach Roof
#+OPTIONS: num:nil toc:3
#+OPTIONS: reveal_center:nil reveal_control:t width:100% height:100%
#+OPTIONS: reveal_history:nil reveal_keyboard:t reveal_overview:t
#+OPTIONS: reveal_slide_number:"c"
#+OPTIONS: reveal_title_slide:"<h2>%t</h2><h5>%d<h5>"
#+OPTIONS: reveal_progress:t reveal_rolling_links:nil reveal_single_file:nil
#+REVEAL_HLEVEL: 1
#+REVEAL_MARGIN: 0
#+REVEAL_MIN_SCALE: 1
#+REVEAL_MAX_SCALE: 1
#+REVEAL_ROOT: file:///Users/zachroof/repos/reveal.js
#+REVEAL_TRANS: default
#+REVEAL_SPEED: default
#+REVEAL_THEME: moon
#+REVEAL_EXTRA_CSS: file:///Users/zachroof/repos/weekly-sts-in-prog/local.css
#+REVEAL_PLUGINS: notes
# YOUTUBE_EXPORT_TAGS:INFOSec,TLS,SSL,Cryptography,Alice,Bob,Trent,Mallory,Active Attacks,Passive Attacks
# YOUTUBE_EXPORT_DESC: 'Start our learning journey into TLS/Cryptography by understanding the "Crypto-Chacters" and the common attacks that they represent.'
# TODO FT:Security-Controls, nmap
* Cyber Kill Chain: Reconnaissance
#+ATTR_REVEAL: :frag (appear)
+ Level: Beginner
+ Attacker researches target given the goal
  1. Find IP Ranges of targets
     1. Censys.io
        1. Background
           1. Maintained by computer scientists at
              1. University Of Michigan
              2. University of Illinois Urbana-Champaign
           2. Notable feature
              1. Crawls the entire public IPv4 space and allows you to full-text
                 search the results
           3. Data Overview
              1. Primary Datasets
                 1. IPv4 Address Space
                 2. Alexa Top Million Domains
                 3. X.509 Certificates
              2. Download/Scan Information
                 1. https://censys.io/data
           4.
           5. Crawls the entire public IPv4 space and allows you to full-text
              search the results
              1. This singular, full-text search includes
                 1. FTP
                 2. SSH
                 3. Telnet
                    1. Passwords sent in the clear
                 4. SMTP/SMTPS
                 5. DNS
                 6. HTTP/HTTPS
                 7. Siemens S7
                 8. POP3/POP3S
                 9. IMAP/IMAPS
                 10. MODBUS
                 11. UPnP
                 12. Niagara Fox
                 13. CWMP
                 14. DNP3
                 15. BACnet
              2. Data is annotated with useful information
                 1. OS Type
                 2. Vulnerable to heartbleed

              3. Scan frequency
           6. Notable Programs That Censys Leverages
              1. [[https://www.zmap.io/][zmap]]
                 1. Maps the network
                 2. On a computer with a gigabit connection, can scan the entire
                    public IPv4 address space in under 45 minutes
              2. [[https://github.com/zmap/zgrab][zgrab]]
                 1. Connects to hosts found in zmap and collects metadata/banners
           7. We collect data about IPv4 hosts through weekly ZMap scans for
              FTP, SSH, Telnet, SMTP, DNS, HTTP, Siemens S7, POP3, IMAP, HTTPS,
              SMTPS, MODBUS, IMAPS, POP3S, UPnP, Niagara Fox, CWMP, DNP3, and
              BACnet. This data is aggregated by ip, port, and protocol to
              construct structured records about each host. For example, HTTPS
              hosts will define 443.https.tls.cipher_suite and Telnet hosts will
              define 23.telnet.banner.banner.

Where possible, we annotate higher-level information such as server software,
geographic location, autonomous system, and device identity with ZTag. The
top-level metadata fields describe the device as a whole and each protocol's
metadata describes information extracted about that protocol's server-side
software.
              1. Censys supports
                 1. protocol
           5. Supports full-text searches on protocol metadata that's retrieved
              1. Ex: 443.https.cipher
           6. Created by/for researchers
              1. Public has rate restricted accessjk
           7. Does a daily zmap/zgrab scan of the internet
           8. Scans
              1. https://censys.io/data
              2. Shows scheduled scans
              3. Primary Datasets
                 1. IPv4 Address Space
                 2. Alexa Top Million Domains
                 3. X.509 Certificates
           9. Other Notable Scans
              1. https://censys.io/data/443-https-heartbleed-full_ipv4
https://groups.google.com/a/censys.io/forum/#!topic/discussion/DGJndylhoGg
        2. Through zmap/zgrab
        3. Searches
           1. Hosts on the Public IPv4 Address Space
 1. If website, can search entire HTTPS response
           2. X.509 Certificates
        4. Example Searches
           1. location.country_code: US and tags: scada
              1. Industrial Control Systems within the US
           2. not 443.https.tls.validation.browser_trusted: true
              1. Websites that have erroneous certificates
           3. location.country_code: US and protocols: ("23/telnet" or "21/ftp")
              1. Telnet and FTP Servers in the US
        5. Ex: hackthissite.org censys.io search
           1. Look for vulnerabilities/attack vectors
              1. What ports are open
                 1. Look for Honey Pots
                    1. Unrealistic open ports
                       1. Number and Service
                       2. Would a host really have mySQL and Mongo on it?
              2.
              3. Vulnerable Ciphers
              4. Customer Environments that are on seperate servers?
                 1. Legacy systems the might not be updated as frequently
                 2. Virtual Hosting
                    1. Most customer pages usually resolve to 1 server group
              5. Location
                 1. Can signify DEV/PROD environments
                    1. Which one is DEV?
                       1. Multi-location company with engineering headquarters in florida
                          1. Found this via website
                          2. DEV environment is likely to be in east region
                 2. Satellite locations will probably have looser security
              6. Hosting Providers
                 1. Most are in AWS but 1 is in Azure?
                    1. Azure might be a temporary environment
                       1. Pivot point
                 2. Cloudflare?
                 3. CloudFail - Unmask server IP addresses hidden behind
                    Cloudflare by searching old database records and detecting
                    misconfigured DNS.
              7. Printers?

                 1. Printer Exploitation Toolkit (PRET) - Tool for printer
                    security testing capable of IP and USB connectivity,
                    fuzzing, and exploitation of PostScript, PJL, and PCL
                    printer language features.

                    1. Capture print jobs

              8. Routers?

                 1. https://github.com/reverse-shell/routersploit

                    1. Routers are often not upgraded

              9. Webserver
                 1. Google Hacking
                 2. waybackmachine
                 3. Find virtual hosts
                    1. Companies usually publish their customers.  If a given
                       company isn't on the main server with all of the vhosts,
                       it might be a one off environment that's more vulnerable
                    2. Bing: "IP:*" syntax with "OR" for range
              10. VPN or gateway in DNS
                  1. Great pivot point
                  2. gw as well
                  3. Fake upgrades by controlling DNS
                     1. https://github.com/infobyte/evilgrade
              11. DHCP Server
                  1. When performing internal testing, first enumerate your local
                     subnet, and you can often extrapolate from there to other
                     subnets by modifying the address slightly. Also, a look a
                     the routing table of an internal host can be particularly
                     telling. Below are a number of techniques which can be used.

DHCP servers can be a potential source of not just local information, but also
remote IP range and details of important hosts. Most DHCP servers will provide a
local IP gateway address as well as the address of DNS and WINS servers. In
Windows based networks, DNS servers tend to be Active Directory domain
controllers, and thus targets of interest.
              1. DNS
                 1. DNS TXT Records
                    1. used to verify many cloud based services
                 2. Hacks I can be you
                 3. Naming Conventions
                 4. prod.hackthissite.org
                    1. what about dev.hackthissite.org
                       1. UAT, test, stage, staging, dev
                 5. Azure/AWS
                    1. AWS S3
                       1. https://BUCKET_NAME.s3.amazonaws.com
                       2. Examples to try
                          1. https://hackthissite.s3.amazonaws.com
                          2. https://hack-this-site.s3.amazonaws.com
                          3. https://dev-hackthissite.s3.amazonaws.com
                 6. Network Topology
                    1. Traditional 3-tier architecture
                       1. Browser --> API Server --> Database
                          1. Potential Attack Vectors
                             1. Too much trust between API and Database
                          2. Caching layer
                             1. Caching attacks
                             2. DoS
                    2. DB
                       1. DNS names with sql or nosql
                    3. Modern Cloud
                       1. Browser could be making direct calls to Database
                          1. Investigate client-side code
                 7. Lower security dev environment where one can pivot into
                    privileged servers
              2. Network Topology
              3. Any self-signed certs
              4. Federated servers
                 1. No standard naming
                 2. adfs
                 3. auth
                 4. fs
                 5. okta
                 6. ping
                 7. sso
                 8. sts
              5. Devops Tools
                 1. Jenkins server
                    1. Can pivot between dev/prod
                    2. usually has creds to all environments
                    3.
                 2. Give common names
              6. Docker Registry
                 1. registry.*.com
                 2. Usually has secrets
              7. logging servers
                 1. Standard names
                    1. Prometheus
                 2. XSS and juicy info/ session tokens, etc
              8. git servers?
                 1. Intellectual Property, wiki on-boarding information, etc.
                 2. Automatated build on merge into dev.
                    1. Can inject malicious code to get into jenkins
                    2. https://github.com/spaceB0x/cider
                 3. Auto
              9. smtp servers?
                 1. Social Engineering Attacks via fake emails
                    1. Social Engineering = Human Minipulation
                       1. https://www.amazon.com/Social-Engineering-Art-Human-Hacking/dp/0470639539
              10. Note "198.148.81.0/24" subnet.  Invoke new search.
              11. Note git.hackthissite.org
              12. Censys.io
